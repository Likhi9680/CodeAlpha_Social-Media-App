<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>InstaMedia - Login</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="auth-page">

<div class="auth-card">

  <div class="auth-header">
    <h1>InstaMediaApp</h1>
    <button class="theme-toggle" id="themeToggle">ðŸŒ™</button>
  </div>

  <!-- Login -->
  <div id="login-form">
    <input id="login-username" placeholder="Username">
    <input id="login-password" type="password" placeholder="Password">
    <button id="login-btn">Login</button>
    <p>New user? <a id="show-register">Create account</a></p>
    <span id="login-error" class="error-text"></span>
  </div>

  <!-- Register -->
  <div id="register-form" style="display:none;">
    <input id="register-username" placeholder="Username">
    <input id="register-password" type="password" placeholder="Password">
    <button id="register-btn">Register</button>
    <p>Already have account? <a id="show-login">Login</a></p>
    <span id="register-error" class="error-text"></span>
  </div>

</div>


<script>
const API_BASE = 'https://social-media-app-rtxu.onrender.com/api';

const loginForm = document.getElementById("login-form");
const registerForm = document.getElementById("register-form");

// Toggle forms
document.getElementById("show-register").onclick = () => {
  loginForm.style.display = "none";
  registerForm.style.display = "block";
};
document.getElementById("show-login").onclick = () => {
  registerForm.style.display = "none";
  loginForm.style.display = "block";
};

// Theme
const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
if (!localStorage.getItem("theme")) {
  document.body.classList.toggle("dark", prefersDark);
  localStorage.setItem("theme", prefersDark ? "dark" : "light");
} else {
  document.body.classList.toggle("dark", localStorage.getItem("theme") === "dark");
}

const toggleBtn = document.getElementById("themeToggle");
toggleBtn.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ðŸŒ™";

toggleBtn.onclick = () => {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  localStorage.setItem("theme", isDark ? "dark" : "light");
  toggleBtn.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
};

// Login
document.getElementById("login-btn").onclick = async () => {
  const username = loginForm.querySelector("#login-username").value;
  const password = loginForm.querySelector("#login-password").value;

  const res = await fetch(`${API_BASE}/users/login`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({username, password})
  });

  const data = await res.json();
  if (!res.ok) return document.getElementById("login-error").innerText = data.message;

  localStorage.setItem("user", JSON.stringify(data));
  window.location = "dashboard.html";
};

// Register
document.getElementById("register-btn").onclick = async () => {
  const username = registerForm.querySelector("#register-username").value;
  const password = registerForm.querySelector("#register-password").value;

  const res = await fetch(`${API_BASE}/users/register`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({username, password})
  });

  const data = await res.json();
  if (!res.ok) return document.getElementById("register-error").innerText = data.message;

  localStorage.setItem("user", JSON.stringify(data));
  window.location = "dashboard.html";
};
</script>

</body>
</html>
